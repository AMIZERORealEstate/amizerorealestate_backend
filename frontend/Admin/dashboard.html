<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMIZERO Admin Dashboard</title>
    <link rel="icon" type="image/x-icon" href="images/company_logo_blue_color-removebg-preview.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #06b6d4;
            --light-bg: #f8fafc;
            --white: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --border-radius: 0.75rem;
            --border-radius-sm: 0.5rem;
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--light-bg);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 14px;
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%);
            position: relative;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><radialGradient id="a" cx="50%" cy="50%"><stop offset="0%" stop-color="%23fff" stop-opacity="0.1"/><stop offset="100%" stop-color="%23fff" stop-opacity="0"/></radialGradient></defs><circle cx="200" cy="200" r="100" fill="url(%23a)"/><circle cx="800" cy="300" r="150" fill="url(%23a)"/><circle cx="400" cy="700" r="120" fill="url(%23a)"/></svg>');
            opacity: 0.3;
        }

        .login-card {
            background: var(--white);
            border-radius: 1.5rem;
            box-shadow: var(--shadow-xl);
            padding: 3rem;
            width: 100%;
            max-width: 420px;
            text-align: center;
            position: relative;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .login-header {
            margin-bottom: 2.5rem;
        }

        .login-header h1 {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .login-header p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .form-group input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
            color: var(--text-primary);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 0.875rem;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            border: none;
            border-radius: var(--border-radius-sm);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .login-btn:hover::before {
            left: 100%;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            color: var(--danger-color);
            font-size: 0.875rem;
            margin-top: 1rem;
            padding: 0.75rem;
            background: rgb(239 68 68 / 0.1);
            border: 1px solid rgb(239 68 68 / 0.2);
            border-radius: var(--border-radius-sm);
            display: none;
        }

        /* Dashboard Styles */
        .dashboard-container {
            display: none;
            min-height: 100vh;
            background: var(--light-bg);
        }

        .dashboard-header {
            background: var(--white);
            box-shadow: var(--shadow-sm);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .dashboard-title h1 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .dashboard-title p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .dashboard-nav {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .nav-item {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.875rem;
            position: relative;
        }

        .nav-item:hover {
            background: rgb(37 99 235 / 0.1);
            color: var(--primary-color);
        }

        .nav-item.active {
            background: var(--primary-color);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .logout-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-size: 0.875rem;
            margin-left: 1rem;
        }

        .logout-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .dashboard-content {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 1.5rem;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--info-color));
        }

        .stat-icon {
            width: 4rem;
            height: 4rem;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .stat-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .stat-card:hover .stat-icon::before {
            left: 100%;
        }

        .stat-icon.properties { 
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); 
        }
        .stat-icon.inquiries { 
            background: linear-gradient(135deg, var(--success-color), #059669); 
        }
        .stat-icon.team { 
            background: linear-gradient(135deg, var(--warning-color), #d97706); 
        }
        .stat-icon.portfolio { 
            background: linear-gradient(135deg, var(--danger-color), #dc2626); 
        }

        .stat-info h3 {
            font-size: 2rem;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
            font-weight: 700;
            line-height: 1;
        }

        .stat-info p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .content-section {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
            display: none;
            overflow: hidden;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-color);
            background: rgb(248 250 252);
        }

        .section-title {
            font-size: 1.25rem;
            color: var(--text-primary);
            font-weight: 600;
            letter-spacing: -0.025em;
        }

        .add-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            padding: 0.625rem 1.25rem;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            font-size: 0.875rem;
            position: relative;
            overflow: hidden;
        }

        .add-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .add-btn:hover::before {
            left: 100%;
        }

        .add-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
          .table-wrapper {
    width: 100%;
    overflow-x: auto;  
}


.table-wrapper th:nth-child(9), /* 9th column is Description */
.table-wrapper td:nth-child(9) {
    max-width: 250px;      /* adjust width as needed */
    white-space: nowrap;    /* prevent wrapping */
    overflow: auto;       /* hide overflow */
   
}


/* Make images smaller if needed */
.data-table td img {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 5px;
}

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            
        }

       

        .data-table th,
        .data-table td {
            white-space: nowrap;
            padding: 1rem 1.5rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.875rem;
           
        }

        .data-table th {
            background: rgb(248 250 252);
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.025em;
            font-size: 0.75rem;

        }

        .data-table tbody tr {
            transition: var(--transition);
        }

        .data-table tbody tr:hover {
            background: rgb(248 250 252 / 0.5);
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        .action-btn {
            padding: 0.375rem 0.75rem;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            margin: 0 0.125rem;
            font-size: 0.75rem;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .edit-btn {
            background: var(--info-color);
            color: white;
        }

        .edit-btn:hover {
            background: #0891b2;
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .delete-btn {
            background: var(--danger-color);
            color: white;
        }

        .delete-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: var(--white);
            margin: 2% auto;
            padding: 0;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            box-shadow: var(--shadow-xl);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-color);
            background: rgb(248 250 252);
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0.25rem;
            border-radius: var(--border-radius-sm);
            transition: var(--transition);
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: rgb(239 68 68 / 0.1);
            color: var(--danger-color);
        }

        .modal form {
            padding: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .form-group select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
            color: var(--text-primary);
            cursor: pointer;
        }

        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .btn {
            padding: 0.625rem 1.25rem;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            font-size: 0.875rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
            transform: translateY(-1px);
        }

        /* Status Badges */
        .status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .status-badge.available {
            background: rgb(16 185 129 / 0.1);
            color: var(--success-color);
        }

        .status-badge.sold {
            background: rgb(239 68 68 / 0.1);
            color: var(--danger-color);
        }

        .status-badge.pending {
            background: rgb(245 158 11 / 0.1);
            color: var(--warning-color);
        }

        /* Loading Spinner */
        .loading {
            display: inline-block;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 5s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Messages */
        .message {
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius-sm);
            margin-bottom: 1.5rem;
            display: none;
            font-weight: 500;
        }

        .message.success {
            background: rgb(16 185 129 / 0.1);
            color: #065f46;
            border: 1px solid rgb(16 185 129 / 0.2);
        }

        .message.error {
            background: rgb(239 68 68 / 0.1);
            color: #991b1b;
            border: 1px solid rgb(239 68 68 / 0.2);
        }

        .message.show {
            display: block;
        }

        /* Recent Activity Styles */
        #recentActivity {
            padding: 2rem;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 2.5rem;
            height: 2.5rem;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.875rem;
        }

        .activity-content h4 {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .activity-content p {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .activity-time {
            margin-left: auto;
            color: var(--text-secondary);
            font-size: 0.75rem;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .dashboard-content {
                padding: 1.5rem;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
                padding: 1rem;
            }

            .dashboard-nav {
                flex-wrap: wrap;
                justify-content: center;
            }

            .dashboard-content {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .data-table {
                font-size: 0.75rem;
            }

            .data-table th,
            .data-table td {
                padding: 0.75rem 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 5% auto;
            }

            .login-card {
                padding: 2rem;
                margin: 1rem;
            }
        }

        @media (max-width: 480px) {
            .dashboard-nav {
                flex-direction: column;
                width: 100%;
            }

            .nav-item {
                width: 100%;
                text-align: center;
            }

            .logout-btn {
                width: 100%;
                margin-left: 0;
                margin-top: 0.5rem;
            }

            .data-table th,
            .data-table td {
                padding: 0.5rem;
            }

            .action-btn {
                padding: 0.25rem 0.5rem;
                font-size: 0.625rem;
            }
        }

        /* Print Styles */
        @media print {
            .dashboard-nav,
            .add-btn,
            .action-btn,
            .logout-btn {
                display: none !important;
            }

            .dashboard-container {
                background: white !important;
            }

            .content-section {
                box-shadow: none !important;
                border: 1px solid #ccc !important;
            }
        }

        /* Focus Styles for Accessibility */
        *:focus-visible {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Smooth Scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }


     
    

    .status-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .status-badge.pending {
        background: #fef5e7;
        color: #744210;
        border: 1px solid #f6e05e;
    }

    .status-badge.confirmed {
        background: #f0fff4;
        color: #276749;
        border: 1px solid #9ae6b4;
    }

    .status-badge.completed {
        background: #ebf8ff;
        color: #2c5282;
        border: 1px solid #90cdf4;
    }

    .status-badge.cancelled {
        background: #fed7d7;
        color: #c53030;
        border: 1px solid #feb2b2;
    }

    .action-btn {
        background: none;
        border: 1px solid #e2e8f0;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        margin-right: 8px;
        font-size: 0.875rem;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }

    .action-btn:hover {
        background: #f7fafc;
        border-color: #cbd5e0;
    }

    .edit-btn {
        color: #3182ce;
    }

    .edit-btn:hover {
        background: #ebf8ff;
        border-color: #3182ce;
    }

    .delete-btn {
        color: #e53e3e;
    }

    .delete-btn:hover {
        background: #fed7d7;
        border-color: #e53e3e;
    }

    .confirm-btn {
        color: #38a169;
    }

    .confirm-btn:hover {
        background: #f0fff4;
        border-color: #38a169;
    }

    .property-link {
        color: #3182ce;
        text-decoration: none;
        font-weight: 500;
    }

    .property-link:hover {
        text-decoration: underline;
    }

    .client-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .client-name {
        font-weight: 600;
        color: #2d3748;
    }

    .client-message {
        font-size: 0.75rem;
        color: #718096;
        font-style: italic;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .empty-state {
        text-align: center;
        padding: 3rem 2rem;
        color: #718096;
    }

    .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: #cbd5e0;
    }

    .empty-state h3 {
        margin-bottom: 0.5rem;
        color: #4a5568;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.5rem 2rem;
        border-bottom: 1px solid #e2e8f0;
    }

    .section-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #2d3748;
        margin: 0;
    }

    .content-section {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        margin-bottom: 2rem;
    }

    @media (max-width: 768px) {
        .data-table {
            font-size: 0.875rem;
        }
        
        .data-table th,
        .data-table td {
            padding: 8px 12px;
        }
        
        .action-btn {
            padding: 4px 8px;
            margin-right: 4px;
        }
        
        .client-message {
            display: none;
        }
    }




    .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
        
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .form-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .input-group {
            position: relative;
        }

        .input-group label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .input-group input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }

        .alert {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
            display: none;
        }

        .alert-success {
            background: linear-gradient(45deg, #d4edda, #c3e6cb);
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .alert-error {
            background: linear-gradient(45deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .current-values {
            background: linear-gradient(45deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .current-values h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .values-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .value-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .value-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .value-label {
            color: #666;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }

        .skill-tag {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 4px 8px;
            margin: 2px;
            border-radius: 12px;
            font-size: 12px;
        }

        .skill-remove {
            background: none;
            border: none;
            color: white;
            margin-left: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .skill-badge {
            display: inline-block;
            background: #e9ecef;
            color: #333;
            padding: 2px 6px;
            margin: 1px;
            border-radius: 8px;
            font-size: 11px;
        }

        .skills-container {
            margin-top: 10px;
            min-height: 40px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 8px;
        }

        .skills-display {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .social-links {
            display: flex;
            gap: 8px;
        }

        .social-link {
            color: #3182ce;
            font-size: 1.2rem;
            transition: all 0.2s;
        }

        .social-link:hover {
            color: #2c5282;
            transform: scale(1.1);
        }

        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-sale { background: #e3f2fd; color: #1976d2; }
        .badge-rent { background: #f3e5f5; color: #7b1fa2; }
        .badge-success { background: #e8f5e8; color: #2e7d32; }
        .badge-new { background: #fff3e0; color: #f57c00; }
        .badge-pending { background: #fff3e0; color: #f57c00; }
        .badge-completed { background: #e8f5e8; color: #2e7d32; }
        .badge-valuation { background: #e3f2fd; color: #1976d2; }
        .badge-management { background: #e8f5e8; color: #2e7d32; }
        .badge-brokerage { background: #f3e5f5; color: #7b1fa2; }
        .badge-survey { background: #fff3e0; color: #f57c00; }




 /* Add styling for the visitors card icon */
    .stat-icon.visitors {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .stat-info small {
        display: block;
        margin-top: 5px;
    }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1>AMIZERO Admin</h1>
                <p>Real Estate Dashboard Login</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="login-btn" id="loginBtn">
                    <span id="loginText">Sign In</span>
                    <div id="loginSpinner" class="loading" style="display: none;"></div>
                </button>
                <div id="loginError" class="error-message"></div>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboardPage" class="dashboard-container">
        <header class="dashboard-header">
            <div style="width: 60px; height: 50px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 8px; color: white; font-weight: bold; font-size: 1.2rem;">
                AMZ
            </div>
            <div class="dashboard-title">

                <h1>AMIZERO Real Estate</h1>
                <p>Website Management Dashboard</p>
            </div>
            <nav class="dashboard-nav">
                <button class="nav-item active" data-section="overview">
                    <i class="fas fa-chart-line"></i> Overview
                </button>
                <button class="nav-item" data-section="properties">
                    <i class="fas fa-home"></i> Properties
                </button>
               <button class="nav-item" data-section="scheduled-visits">
    <i class="fas fa-calendar-check"></i> Scheduled Visits
</button>
                <button class="nav-item" data-section="team">
                    <i class="fas fa-users"></i> Team
                </button>
                <button class="nav-item" data-section="portfolio">
                    <i class="fas fa-briefcase"></i> Portfolio
                </button>
                <button class="nav-item" data-section="newsletter">
    <i class="fas fa-envelope"></i> Newsletter
</button>
<button class="nav-item" data-section="achievements">
                    <i class="fas fa-briefcase"></i> Achievements
                </button>

                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </nav>
        </header>

        <main class="dashboard-content">
            <!-- Overview Section -->
<section id="overview" class="content-section active">
    <div class="stats-grid">
        <!-- Existing Properties Card -->
        <div class="stat-card">
            <div class="stat-icon properties">
                <i class="fas fa-home"></i>
            </div>
            <div class="stat-info">
                <h3 id="propertiesCount">24</h3>
                <p>Total Properties</p>
            </div>
        </div>

        <!-- NEW: Website Visitors Card -->
        <div class="stat-card">
            <div class="stat-icon visitors">
                <i class="fas fa-eye"></i>
            </div>
            <div class="stat-info">
                <h3 id="websiteVisitors">0</h3>
                <p>Website Visitors</p>
                <small id="todayVisitors" style="color: #000a9c; font-size: 1.5em;">Today: 0</small>
            </div>
        </div>

        <!-- Total Scheduled Visits -->
        <div class="stat-card">
            <div class="stat-icon visits">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="stat-info">
                <h3 id="totalVisits">0</h3>
                <p>Total Scheduled Visits</p>
            </div>
        </div>

        <!-- Confirmed Visits -->
        <div class="stat-card">
            <div class="stat-icon confirmed">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-info">
                <h3 id="confirmedVisits">0</h3>
                <p>Confirmed Visits</p>
            </div>
        </div>

        <!-- Pending Visits -->
        <div class="stat-card">
            <div class="stat-icon pending">
                <i class="fas fa-hourglass-half"></i>
            </div>
            <div class="stat-info">
                <h3 id="pendingVisits">0</h3>
                <p>Pending Visits</p>
            </div>
        </div>

        <!-- Team Members Card -->
        <div class="stat-card">
            <div class="stat-icon team">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-info">
                <h3 id="teamCount">8</h3>
                <p>Team Members</p>
            </div>
        </div>

        <!-- Portfolio Card -->
        <div class="stat-card">
            <div class="stat-icon portfolio">
                <i class="fas fa-briefcase"></i>
            </div>
            <div class="stat-info">
                <h3 id="portfolioCount">16</h3>
                <p>Portfolio Items</p>
            </div>
        </div>
    </div>

    <!-- Recent Activity Section -->
    <div class="content-section active">
        <div class="section-header">
            <h2 class="section-title">Recent Activity</h2>
        </div>
        <div id="recentActivity">
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-plus"></i>
                </div>
                <div class="activity-content">
                    <h4>New Property Added</h4>
                    <p>Luxury Villa in Kicukiro has been added to the listings</p>
                </div>
                <div class="activity-time">2 hours ago</div>
            </div>
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="activity-content">
                    <h4>New Inquiry Received</h4>
                    <p>Property valuation request from John Doe</p>
                </div>
                <div class="activity-time">4 hours ago</div>
            </div>
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-user"></i>
                </div>
                <div class="activity-content">
                    <h4>Team Member Updated</h4>
                    <p>Sarah Johnson's profile information updated</p>
                </div>
                <div class="activity-time">6 hours ago</div>
            </div>
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-check"></i>
                </div>
                <div class="activity-content">
                    <h4>Property Sale Completed</h4>
                    <p>Apartment in Remera successfully sold</p>
                </div>
                <div class="activity-time">1 day ago</div>
            </div>
        </div>
    </div>
</section>

            <!-- Properties Section -->
            <section id="properties" class="content-section">
                <div class="message" id="propertiesMessage"></div>
                <div class="section-header">
                    <h2 class="section-title">Property Management</h2>
                    <button class="add-btn" id="addPropertyBtn">
                        <i class="fas fa-plus"></i>
                        Add Property
                    </button>
                </div>
                <div style="padding: 2rem; overflow-x: auto;" >
                    <table class="data-table">
                        <thead>
   <tr>
    <th>Image</th>
    <th>Title</th>
    <th>Location</th>
    <th>Price</th>
    <th>Type</th>
    <th>Property Type</th>
    <th>Bedrooms</th>
    <th>Bathrooms</th>
    <th>Area (m²)</th>
    <th>Description</th>
    <th>Status</th>
    <th>Created At</th>
    <th>Updated At</th>
    <th>Actions</th>
  </tr>
</thead>

                        <tbody id="propertiesTableBody">
                            <tr>
                                <td>Modern Villa</td>
                                <td>Kicukiro</td>
                                <td>RWF 85,000,000</td>
                                <td>Villa</td>
                                <td><span class="status-badge available">Available</span></td>
                                <td>
                                    <button class="action-btn edit-btn">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="action-btn delete-btn">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>Downtown Apartment</td>
                                <td>Remera</td>
                                <td>RWF 45,000,000</td>
                                <td>Apartment</td>
                                <td><span class="status-badge sold">Sold</span></td>
                                <td>
                                    <button class="action-btn edit-btn">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="action-btn delete-btn">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>Commercial Space</td>
                                <td>Nyarugenge</td>
                                <td>RWF 120,000,000</td>
                                <td>Commercial</td>
                                <td><span class="status-badge pending">Pending</span></td>
                                <td>
                                    <button class="action-btn edit-btn">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="action-btn delete-btn">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>


            <!-- Schedule visits section -->

            <section id="scheduled-visits" class="content-section">
    <div class="section-header">
        <h2 class="section-title">Scheduled Visits</h2>
    </div>
    <div style="padding: 2rem; overflow: auto;">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Client Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Property</th>
                    <th>Visit Date</th>
                    <th>Visit Time</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="scheduledVisitsTableBody">
                <!-- Loading state -->
                <tr id="loadingRow">
                    <td colspan="8" style="text-align: center; padding: 2rem;">
                        <i class="fas fa-spinner fa-spin"></i> Loading scheduled visits...
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</section>
            <!-- Team Section -->
            <section id="team" class="content-section">
                <div class="message" id="teamMessage"></div>
                <div class="section-header">
                    <h2 class="section-title">Team Management</h2>
                    <button class="add-btn" id="addTeamBtn">
                        <i class="fas fa-plus"></i>
                        Add Team Member
                    </button>
                </div>
                <div style="padding: 2rem;" class="table-wrapper">
                    <table class="data-table">
                    <thead>
            <tr>
                <th>Image</th>
                <th>Name</th>
                <th>Position</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Skills</th>
                <th>Social Links</th>
                <th>Bio</th>
                <th>Actions</th>
            </tr>
        </thead>

                        <tbody id="teamTableBody">
                            <tr>
                                <td>Sarah Johnson</td>
                                <td>Property Manager</td>
                                <td>sarah.johnson@amizero.com</td>
                                <td>+250 788 123 456</td>
                                <td>
                                    <button class="action-btn edit-btn">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="action-btn delete-btn">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>David Wilson</td>
                                <td>Real Estate Agent</td>
                                <td>david.wilson@amizero.com</td>
                                <td>+250 788 234 567</td>
                                <td>
                                    <button class="action-btn edit-btn">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="action-btn delete-btn">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>Maria Garcia</td>
                                <td>Property Valuator</td>
                                <td>maria.garcia@amizero.com</td>
                                <td>+250 788 345 678</td>
                                <td>
                                    <button class="action-btn edit-btn">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="action-btn delete-btn">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Portfolio Section -->
            <section id="portfolio" class="content-section">
                <div class="message" id="portfolioMessage"></div>
                <div class="section-header">
                    <h2 class="section-title">Portfolio Management</h2>
                    <button class="add-btn" id="addPortfolioBtn">
                        <i class="fas fa-plus"></i>
                        Add Portfolio Item
                    </button>
                </div>
                <div style="padding: 2rem;" class="table-wrapper">
                    <table class="data-table">

                        <thead>
   <thead>
    <tr>
        <th>Title</th>
        <th>Category</th>
        <th>Value</th>
        <th>Date</th>
        <th>Client</th>
        <th>Location</th>
        <th>Duration</th>
        <th>Status</th>
        <th>Description</th>
        <th>Image</th>
        <th>Actions</th>
    </tr>
</thead>


                   
                                
                        <tbody id="portfolioTableBody">
                            <tr>
                                <td>Kigali Heights Valuation</td>
                                <td>Property Valuation</td>
                                <td>RWF 2,500,000</td>
                                <td>2024-01-10</td>
                                <td>
                                    <button class="action-btn edit-btn">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="action-btn delete-btn">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>Nyarutarama Estate Management</td>
                                <td>Property Management</td>
                                <td>RWF 15,000,000</td>
                                <td>2024-01-08</td>
                                <td>
                                    <button class="action-btn edit-btn">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="action-btn delete-btn">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>Commercial Complex Survey</td>
                                <td>Quantity Survey</td>
                                <td>RWF 8,500,000</td>
                                <td>2024-01-05</td>
                                <td>
                                    <button class="action-btn edit-btn">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="action-btn delete-btn">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Newsletter Section -->
<section id="newsletter" class="content-section">
    <div class="section-header">
        <h2 class="section-title">Newsletter Subscribers</h2>
    </div>
    <div style="padding: 2rem; overflow-x: auto;">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Subscribed At</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="newsletterTableBody">
                <tr>
                    
                </tr>
            </tbody>
        </table>
    </div>
</section>


<section id="achievements" class="content-section">
        <div class="container" style="padding: 40px;">
        <div class="header">
            <h1>Achievement Manager</h1>
            <p>Update your company's achievements and milestones</p>
        </div>

        <div id="alert" class="alert"></div>

        <div class="current-values" id="currentValues">
            <h3>Current Achievement Values</h3>
            <div class="values-grid">
                <div class="value-item">
                    <div class="value-number" id="currentListings">Loading...</div>
                    <div class="value-label">Listings</div>
                </div>
                <div class="value-item">
                    <div class="value-number" id="currentProperties">Loading...</div>
                    <div class="value-label">Properties Managed</div>
                </div>
                <div class="value-item">
                    <div class="value-number" id="currentTransactions">Loading...</div>
                    <div class="value-label">Transactions</div>
                </div>
                <div class="value-item">
                    <div class="value-number" id="currentProjects">Loading...</div>
                    <div class="value-label">Projects</div>
                </div>
            </div>
        </div>

        <form id="achievementForm" class="form-section">
            <h2 class="section-title">Update Achievement Numbers</h2>
            
            <div class="form-grid">
                <div class="input-group">
                    <label for="listings">Number of Listings</label>
                    <input type="number" id="listings" name="listings" min="0" required>
                </div>

                <div class="input-group">
                    <label for="propertiesManaged">Properties Managed</label>
                    <input type="number" id="propertiesManaged" name="propertiesManaged" min="0" required>
                </div>

                <div class="input-group">
                    <label for="transactions">Transactions Completed</label>
                    <input type="number" id="transactions" name="transactions" min="0" required>
                </div>

                <div class="input-group">
                    <label for="projects">Number of Projects</label>
                    <input type="number" id="projects" name="projects" min="0" required>
                </div>
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-secondary" onclick="loadCurrentValues()">
                    Load Current Values
                </button>
                <button type="submit" class="btn btn-primary">
                    Update Achievements
                </button>
            </div>
        </form>
    </div>
    </section>

        </main>
    </div>

    
    



    

    <!-- Property Modal -->
    <div id="propertyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="propertyModalTitle">Add Property</h2>
                <button class="close-btn" onclick="closeModal('propertyModal')">&times;</button>
            </div>
            <form id="propertyForm"  enctype="multipart/form-data">
                <input type="hidden" id="propertyId">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="propertyTitle">Title</label>
                        <input type="text" id="propertyTitle" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="propertyLocation">Location</label>
                        <input type="text" id="propertyLocation" name="location" required>
                    </div>
                    <div class="form-group">
                        <label for="propertyPrice">Price (RWF)</label>
                        <input type="number" id="propertyPrice" name="price" required>
                    </div>
                    <div class="form-group">
                        <label for="propertyType">Type</label>
                        <select id="propertyType" name="type" required>
                            <option value="">Select Type</option>
                            <option value="sale">For Sale</option>
                            <option value="rent">For Rent</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="propertyCategory">Category</label>
                        <select id="propertyCategory" name="propertyType" required>
                            <option value="">Select Category</option>
                            <option value="house">House</option>
                            <option value="apartment">Apartment</option>
                            <option value="villa">Villa</option>
                            <option value="office">Office</option>
                            <option value="land">Land</option>
                            <option value="commercial">Commercial</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="propertyBedrooms">Bedrooms</label>
                        <input type="number" id="propertyBedrooms" name="bedrooms" min="0">
                    </div>
                    <div class="form-group">
                        <label for="propertyBathrooms">Bathrooms</label>
                        <input type="number" id="propertyBathrooms" name="bathrooms" min="0">
                    </div>
                    <div class="form-group">
                        <label for="propertyArea">Area (m²)</label>
                        <input type="number" id="propertyArea" name="area" min="0">
                    </div>
                    <div class="form-group">
                        <label for="propertyImage">Property Image</label>
                        <input type="file" id="propertyImage" name="images" multiple accept="image/*">
                    </div>
                    <div id="preview"></div>
                </div>
                <div class="form-group">
                    <label for="propertyDescription">Description</label>
                    <textarea id="propertyDescription" name="description" rows="8" cols="60"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('propertyModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Property</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Team Modal -->
<div id="teamModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" id="teamModalTitle">Add Team Member</h2>
            <button class="close-btn" onclick="closeModal('teamModal')">&times;</button>
        </div>
        <form id="teamForm" enctype="multipart/form-data">
            <input type="hidden" id="teamId">

            <div class="form-grid">
                <div class="form-group">
                    <label for="teamName">Full Name *</label>
                    <input type="text" id="teamName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="teamPosition">Position *</label>
                    <input type="text" id="teamPosition" name="position" required>
                </div>
                <div class="form-group">
                    <label for="teamEmail">Email *</label>
                    <input type="email" id="teamEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="teamPhone">Phone</label>
                    <input type="tel" id="teamPhone" name="phone">
                </div>
                <div class="form-group">
                    <label for="teamImage">Profile Image</label>
                    <input type="file" id="teamImage" name="image" accept="image/*">
                </div>
                <div class="form-group">
                    <label for="skillInput">Skills</label>
                    <input type="text" id="skillInput" placeholder="Type skill and press Enter">
                    <div class="skills-container" id="skillsContainer"></div>
                    <input type="hidden" id="skillsHidden" name="skills">
                </div>
            </div>

            <div class="form-group" style="padding: 0 10px;">
                <label for="teamBio">Bio</label>
                <textarea id="teamBio" name="bio" rows="10" cols="50"  placeholder="add a team member bio..." style="padding: 20px;"></textarea>
            </div>

            <!-- Social Links Section -->
            <div style="padding: 20px;">
                <h3 style="margin-bottom: 15px; color: #333;">Social Links</h3>
                <div class="social-links-grid">
                    <div class="form-group">
                        <label for="linkedinLink"><i class="fab fa-linkedin"></i> LinkedIn</label>
                        <input type="url" id="linkedinLink" name="socialLinks.linkedin" placeholder="https://linkedin.com/in/username">
                    </div>
                    <div class="form-group">
                        <label for="twitterLink"><i class="fab fa-twitter"></i> Twitter</label>
                        <input type="url" id="twitterLink" name="socialLinks.twitter" placeholder="https://twitter.com/username">
                    </div>
                    <div class="form-group">
                        <label for="emailLink"><i class="fas fa-envelope"></i> Contact Email</label>
                        <input type="email" id="emailLink" name="socialLinks.email" placeholder="contact@example.com">
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('teamModal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Team Member</button>
            </div>
        </form>
    </div>
</div>

    <!-- Portfolio Modal -->
<div id="portfolioModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" id="portfolioModalTitle">Add Portfolio Item</h2>
            <button class="close-btn" onclick="closeModal('portfolioModal')">&times;</button>
        </div>
        <form id="portfolioForm" enctype="multipart/form-data">
            <input type="hidden" id="portfolioId">

            <div class="form-grid">
                <div class="form-group">
                    <label for="portfolioTitle">Title</label>
                    <input type="text" id="portfolioTitle" name="title" required>
                </div>
                <div class="form-group">
                    <label for="portfolioCategory">Category</label>
                    <select id="portfolioCategory" name="category" required>
                        <option value="">Select Category</option>
                        <option value="valuation">Property Valuation</option>
                        <option value="management">Property Management</option>
                        <option value="brokerage">Real Estate Brokerage</option>
                        <option value="survey">Quantity Survey</option>
                        <option value="development">Property Development</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="portfolioValue">Value (RWF)</label>
                    <input type="text" id="portfolioValue" name="value">
                </div>
                <div class="form-group">
                    <label for="portfolioDate">Project Date</label>
                    <input type="date" id="portfolioDate" name="date" required>
                </div>
                <div class="form-group">
                    <label for="portfolioClient">Client</label>
                    <input type="text" id="portfolioClient" name="client">
                </div>
                <div class="form-group">
                    <label for="portfolioLocation">Location</label>
                    <input type="text" id="portfolioLocation" name="location">
                </div>
                <div class="form-group">
                    <label for="portfolioDuration">Duration</label>
                    <input type="text" id="portfolioDuration" name="duration">
                </div>
                <div class="form-group">
                    <label for="portfolioStatus">Status</label>
                    <select id="portfolioStatus" name="status">
                        <option value="completed">Completed</option>
                        <option value="ongoing">Ongoing</option>
                        <option value="planned">Planned</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="portfolioImages">Upload Images</label>
                <input type="file" id="portfolioImages" name="images" multiple accept="image/*">
            </div>

            <div class="form-group">
                <label for="portfolioDescription">Description</label>
                <textarea id="portfolioDescription" name="description" rows="10" cols="50" required></textarea>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('portfolioModal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Portfolio Item</button>
            </div>
        </form>
    </div>
</div>

<script>
// ============================================== 
// EMBEDDED DASHBOARD.JS CODE - ALL FUNCTIONALITY
// ==============================================

// Dashboard JavaScript
class AdminDashboard {
    constructor() {
        this.apiUrl = '/api';
        this.currentSection = 'loginForm';
        this.skills = []; // Move skills array into the class
        this.init();
    }

    init() {
        this.setupEventListeners();
        this.checkAuthStatus();
        this.setupSkillsInput(); // Add skills setup
    }

    setupEventListeners() {
        // Login form
        document.getElementById('loginForm').addEventListener('submit', this.handleLogin.bind(this));
        
        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => this.switchSection(e.target.dataset.section));
        });
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', this.handleLogout.bind(this));
        
        // Modal buttons
        document.getElementById('addPropertyBtn').addEventListener('click', () => this.openModal('propertyModal', 'add'));
        document.getElementById('addTeamBtn').addEventListener('click', () => this.openModal('teamModal', 'add'));
        document.getElementById('addPortfolioBtn').addEventListener('click', () => this.openModal('portfolioModal', 'add'));
        
        // Form submissions
        document.getElementById('propertyForm').addEventListener('submit', this.handlePropertySubmit.bind(this));
        document.getElementById('teamForm').addEventListener('submit', this.handleTeamSubmit.bind(this));
        document.getElementById('portfolioForm').addEventListener('submit', this.handlePortfolioSubmit.bind(this));
        
        // Close modals when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    this.closeModal(modal.id);
                }
            });
        });
    }

    // Skills management setup
setupSkillsInput() {
    const skillInput = document.getElementById('skillInput');
    if (skillInput) {
        // Add skills on Enter key
        skillInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                this.addSkillsFromInput(e.target.value);
                e.target.value = '';
            }
        });

        // Optional: handle paste with commas
        skillInput.addEventListener('paste', (e) => {
            e.preventDefault();
            const pasteData = e.clipboardData.getData('text');
            this.addSkillsFromInput(pasteData);
        });
    }

    // Ensure hidden input is updated before form submit
    const teamForm = document.getElementById('teamForm');
    if (teamForm) {
        teamForm.addEventListener('submit', () => {
            this.updateSkillsHidden();
        });
    }
}

// Add skills from input string (handles comma-separated values)
addSkillsFromInput(inputValue) {
    if (!inputValue) return;

    // Split by commas, trim, and filter out empty strings
    const newSkills = inputValue.split(',').map(s => s.trim()).filter(s => s);

    newSkills.forEach(skill => {
        if (!this.skills.includes(skill)) {
            this.skills.push(skill);
        }
    });

    this.updateSkillsDisplay();
    this.updateSkillsHidden();
}

// Remove skill
removeSkill(skill) {
    this.skills = this.skills.filter(s => s !== skill);
    this.updateSkillsDisplay();
    this.updateSkillsHidden();
}

// Update skills display
updateSkillsDisplay() {
    const container = document.getElementById('skillsContainer');
    if (container) {
        container.innerHTML = this.skills.map(skill => `
            <span class="skill-tag">
                ${skill}
                <button type="button" class="skill-remove" onclick="dashboard.removeSkill('${skill}')">&times;</button>
            </span>
        `).join('');
    }
}

// Update hidden input for backend
updateSkillsHidden() {
    const hiddenInput = document.getElementById('skillsHidden');
    if (hiddenInput) {
        hiddenInput.value = JSON.stringify(this.skills);
    }
}


    // Authentication methods
    async handleLogin(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const credentials = {
            email: formData.get('email'),
            password: formData.get('password')
        };

        this.showLoading('loginBtn', true);

        try {
            const response = await fetch(`${this.apiUrl}/auth/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(credentials)
            });

            const result = await response.json();

            if (response.ok) {
                localStorage.setItem('adminToken', result.token);
                console.log('Token saved to localStorage:', result.token);
                this.showDashboard();
                
                // Load additional data after showing dashboard
                setTimeout(() => {
                    loadNewsletterSubscribers();
                    loadDashboardOverview();
                    loadScheduledVisits();
                    loadCurrentValues();
                }, 500);
            } else {
                this.showError('loginError', result.message || 'Invalid credentials');
            }
        } catch (error) {
            this.showError('loginError', 'Connection error. Please try again.');
        }

        this.showLoading('loginBtn', false);
    }

    handleLogout() {
        localStorage.removeItem('adminToken');
        this.showLogin();
    }

    async checkAuthStatus() {
        const token = localStorage.getItem('adminToken');
        if (!token) {
            this.showLogin();
            return;
        }

        try {
            const response = await fetch(`${this.apiUrl}/auth/verify`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (response.ok) {
                this.showDashboard();
            } else {
                localStorage.removeItem('adminToken');
                this.showLogin();
            }
        } catch (error) {
            this.showLogin();
        }
    }

    showLogin() {
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('dashboardPage').style.display = 'none';
    }

    showDashboard() {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('dashboardPage').style.display = 'block';
        
        // Wait a bit to ensure dashboard is visible before loading data
        setTimeout(() => {
            this.loadDashboardData();
            // Load the standalone function data
            loadNewsletterSubscribers();
            loadDashboardOverview();
            loadScheduledVisits();
            loadCurrentValues();
        }, 300);
    }

    // Dashboard data loading
    async loadDashboardData() {
        await Promise.all([
            this.loadStats(),
            this.loadProperties(),
            this.loadTeamMembers(),
            this.loadPortfolio(),
            this.loadRecentActivity()
        ]);
    }

    async loadStats() {
        try {
            const response = await this.authenticatedFetch('/stats');
            const stats = await response.json();
            
            document.getElementById('propertiesCount').textContent = stats.properties || 0;
            document.getElementById('teamCount').textContent = stats.team || 0;
            document.getElementById('portfolioCount').textContent = stats.portfolio || 0;
        } catch (error) {
            console.error('Error loading stats:', error);
        }
    }

    async loadProperties() {
        try {
            const response = await this.authenticatedFetch('/properties');
            const properties = await response.json();
            this.renderPropertiesTable(properties);
        } catch (error) {
            console.error('Error loading properties:', error);
            document.getElementById('propertiesTableBody').innerHTML = 
                '<tr><td colspan="6" style="text-align: center; color: #e74c3c;">Error loading properties</td></tr>';
        }
    }

    async loadTeamMembers() {
        try {
            const response = await this.authenticatedFetch('/team');
            const team = await response.json();
            this.renderTeamTable(team);
        } catch (error) {
            console.error('Error loading team members:', error);
            document.getElementById('teamTableBody').innerHTML = 
                '<tr><td colspan="5" style="text-align: center; color: #e74c3c;">Error loading team members</td></tr>';
        }
    }

    async loadPortfolio() {
        try {
            const response = await this.authenticatedFetch('/portfolio');
            const portfolio = await response.json();
            this.renderPortfolioTable(portfolio);
        } catch (error) {
            console.error('Error loading portfolio:', error);
            document.getElementById('portfolioTableBody').innerHTML = 
                '<tr><td colspan="5" style="text-align: center; color: #e74c3c;">Error loading portfolio</td></tr>';
        }
    }

    async loadRecentActivity() {
        try {
            const response = await this.authenticatedFetch('/activity');
            const activities = await response.json();
            this.renderRecentActivity(activities);
        } catch (error) {
            document.getElementById('recentActivity').innerHTML = '<p style="color: #e74c3c;">Error loading recent activity</p>';
        }
    }



    // Render methods
    renderPropertiesTable(properties) {
        const tbody = document.getElementById('propertiesTableBody');
        if (properties.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #666;">No properties found</td></tr>';
            return;
        }

        tbody.innerHTML = properties.map(property => `
            <tr>
                <td>
                    ${property.images && property.images.length > 0 
                        ? `<img src="${property.images[0]}" alt="Property Image" style="width:100px; height:60px; object-fit:cover; border-radius:5px;">`
                        : 'No Image'}
                </td>
                <td>${property.title}</td>
                <td>${property.location}</td>
                <td>RWF ${new Intl.NumberFormat().format(property.price)}</td>
                <td>${property.type}</td>
                <td>${property.propertyType}</td>
                <td>${property.bedrooms}</td>
                <td>${property.bathrooms}</td>
                <td>${property.area}</td>
                <td>${property.description || ''}</td>
                <td><span class="badge badge-${property.status.toLowerCase()}">${property.status}</span></td>
                <td>${new Date(property.createdAt).toLocaleDateString()}</td>
                <td>${new Date(property.updatedAt).toLocaleDateString()}</td>
                <td>
                    <button class="action-btn edit-btn" onclick="dashboard.editProperty('${property._id}')">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="action-btn delete-btn" onclick="dashboard.deleteProperty('${property._id}')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </td>
            </tr>
        `).join('');
    }

    renderTeamTable(team) {
    const tbody = document.getElementById('teamTableBody');
    if (!team || team.length === 0) {
        tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;color:#666;">No team members found</td></tr>';
        return;
    }
    
    tbody.innerHTML = team.map(member => `
        <tr>
            <td>
                ${
                    member.image
                        ? `<img src="${member.image}" alt="${member.name}" style="width:60px;height:60px;object-fit:cover;border-radius:50%;">`
                        : '<div style="width:60px;height:60px;background:#e9ecef;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#666;"><i class="fas fa-user"></i></div>'
                }
            </td>
            <td><strong>${member.name}</strong></td>
            <td>${member.position}</td>
            <td><a href="mailto:${member.email || member.socialLinks?.email || '#'}" class="social-link">${member.email || member.socialLinks?.email || 'N/A'}</a></td>
            <td>${member.phone || 'N/A'}</td>
            <td>
                <div class="skills-display">
                    ${member.skills && member.skills.length > 0 
                        ? member.skills.map(skill => `<span class="skill-badge">${skill}</span>`).join('')
                        : '<span style="color:#666;">No skills listed</span>'
                    }
                </div>
            </td>
            <td>
                <div class="social-links">
                    ${(member.socialLinks?.linkedin || member.linkedin)
                        ? `<a href="${member.socialLinks?.linkedin || member.linkedin}" target="_blank" class="social-link" title="LinkedIn"><i class="fab fa-linkedin"></i></a>`
                        : ''
                    }
                    ${(member.socialLinks?.twitter || member.twitter)
                        ? `<a href="${member.socialLinks?.twitter || member.twitter}" target="_blank" class="social-link" title="Twitter"><i class="fab fa-twitter"></i></a>`
                        : ''
                    }
                    ${(member.socialLinks?.email || member.email)
                        ? `<a href="mailto:${member.socialLinks?.email || member.email}" class="social-link" title="Email"><i class="fas fa-envelope"></i></a>`
                        : ''
                    }
                    ${(!member.socialLinks?.linkedin && !member.linkedin && !member.socialLinks?.twitter && !member.twitter && !member.socialLinks?.email && !member.email)
                        ? '<span style="color:#666;">N/A</span>'
                        : ''
                    }
                </div>
            </td>
            <td style="max-width:400px; overflow:auto;">
                ${member.bio ? 
                    (member.bio.length > 100 ? 
                        `<span title="${member.bio}">${member.bio.substring(0, 100)}...</span>` : 
                        member.bio
                    ) : 
                    '<span style="color:#666;">No bio available</span>'
                }
            </td>
            <td>
                <button class="action-btn edit-btn" onclick="dashboard.editTeamMember('${member._id}')" title="Edit">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn delete-btn" onclick="dashboard.deleteTeamMember('${member._id}')" title="Delete">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        </tr>
    `).join('');
}
    renderPortfolioTable(portfolio) {
        const tbody = document.getElementById('portfolioTableBody');
        if (!portfolio || portfolio.length === 0) {
            tbody.innerHTML = '<tr><td colspan="12" style="text-align:center;color:#666;">No portfolio items found</td></tr>';
            return;
        }

        tbody.innerHTML = portfolio.map(item => `
            <tr>
                <td>${item.title}</td>
                <td><span class="badge badge-${item.category}">${item.category}</span></td>
                <td>${item.value || 'N/A'}</td>
                <td>${new Date(item.date).toLocaleDateString()}</td>
                <td>${item.client || 'N/A'}</td>
                <td>${item.location || 'N/A'}</td>
                <td>${item.duration || 'N/A'}</td>
                <td>${item.status}</td>
                <td>${item.description || 'N/A'}</td>
                <td>
                    ${
                        item.images && item.images.length > 0
                            ? `<img src="${item.images[0]}" alt="portfolio image" style="width:100px;height:60px;object-fit:cover;border-radius:6px;">`
                            : 'No Image'
                    }
                </td>
                <td>
                    <button class="action-btn edit-btn" onclick="dashboard.editPortfolioItem('${item._id}')">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="action-btn delete-btn" onclick="dashboard.deletePortfolioItem('${item._id}')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </td>
            </tr>
        `).join('');
    }

    renderRecentActivity(activities) {
        const container = document.getElementById('recentActivity');
        if (activities.length === 0) {
            container.innerHTML = '<p style="color: #666;">No recent activity</p>';
            return;
        }

        container.innerHTML = activities.slice(0, 10).map(activity => `
            <div style="padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong>${activity.action}</strong>
                    <p style="margin: 5px 0; color: #666; font-size: 14px;">${activity.description}</p>
                </div>
                <small style="color: #999;">${new Date(activity.timestamp).toLocaleString()}</small>
            </div>
        `).join('');
    }

    // Navigation
    switchSection(section) {
        // Update navigation
        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
        document.querySelector(`[data-section="${section}"]`).classList.add('active');
        
        // Update content
        document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
        document.getElementById(section).classList.add('active');
        
        this.currentSection = section;
    }

    // Modal management
    openModal(modalId, mode, data = null) {
    const modal = document.getElementById(modalId);
    const form = modal.querySelector('form');
    
    if (mode === 'add') {
        form.reset();
        
        // Reset hidden ID fields based on modal type
        if (modalId === 'portfolioModal') {
            document.getElementById('portfolioId').value = '';
        } else if (modalId === 'propertyModal') {
            const hiddenInput = form.querySelector('input[name="propertyId"]');
            if (hiddenInput) hiddenInput.value = '';
        } else if (modalId === 'teamModal') {
            const hiddenInput = form.querySelector('input[name="teamId"]');
            if (hiddenInput) hiddenInput.value = '';
        }
        
        // Reset skills for team modal
        if (modalId === 'teamModal') {
            this.skills = [];
            this.updateSkillsDisplay();
        }
        
        modal.querySelector('.modal-title').textContent = `Add ${modalId.replace('Modal', '')}`;
    } else if (mode === 'edit' && data) {
        this.populateForm(form, data);
        
        // Populate hidden ID field
        if (modalId === 'portfolioModal' && data._id) {
            document.getElementById('portfolioId').value = data._id;
        }
        
        // Load existing skills if editing team member
        if (data.skills && modalId === 'teamModal') {
            this.skills = data.skills;
            this.updateSkillsDisplay();
        }
        
        modal.querySelector('.modal-title').textContent = `Edit ${modalId.replace('Modal', '')}`;
    }
    
    modal.style.display = 'block';
}

    closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    populateForm(form, data) {
    Object.keys(data).forEach(key => {
        // Try to find input by name attribute first
        let input = form.querySelector(`[name="${key}"]`);
        
        // If not found, try by ID (legacy support)
        if (!input) {
            const formPrefix = form.id.replace('Form', '');
            const inputId = `${formPrefix}${key.charAt(0).toUpperCase() + key.slice(1)}`;
            input = document.getElementById(inputId);
        }
        
        if (input) {
            // Handle date fields specially
            if (input.type === 'date' && data[key]) {
                const dateValue = new Date(data[key]);
                if (!isNaN(dateValue.getTime())) {
                    // Format date as YYYY-MM-DD for date input
                    input.value = dateValue.toISOString().split('T')[0];
                }
            } 
            // Handle file inputs (skip them)
            else if (input.type === 'file') {
                // Don't set value for file inputs
                console.log(`Skipping file input: ${key}`);
            }
            // Handle all other inputs
            else {
                input.value = data[key] || '';
            }
        }
    });
    
    // Set hidden ID field if present
    if (data._id) {
        const hiddenInput = form.querySelector('input[type="hidden"]');
        if (hiddenInput) {
            hiddenInput.value = data._id;
        }
    }
}

    // CRUD Operations
    async handlePropertySubmit(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const isEdit = formData.get('propertyId');

        try {
            const url = isEdit ? `/properties/${formData.get('propertyId')}` : '/properties';
            const method = isEdit ? 'PUT' : 'POST';
            
            const response = await this.authenticatedFetch(url, {
                method,
                body: formData
            });

            if (response.ok) {
                this.showMessage('propertiesMessage', `Property ${isEdit ? 'updated' : 'added'} successfully!`, 'success');
                this.closeModal('propertyModal');
                this.loadProperties();
                this.loadStats();
            } else {
                const error = await response.json();
                this.showMessage('propertiesMessage', error.message, 'error');
            }
        } catch (error) {
            this.showMessage('propertiesMessage', 'Error saving property', 'error');
        }
    }

    async handleTeamSubmit(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const isEdit = formData.get('teamId');

        try {
            const url = isEdit ? `/team/${formData.get('teamId')}` : '/team';
            const method = isEdit ? 'PUT' : 'POST';
            
            const response = await this.authenticatedFetch(url, {
                method,
                body: formData
            });

            if (response.ok) {
                this.showMessage(
                    'teamMessage',
                    `Team member ${isEdit ? 'updated' : 'added'} successfully!`,
                    'success'
                );
                this.closeModal('teamModal');
                this.loadTeamMembers();
                this.loadStats();
            } else {
                const error = await response.json();
                this.showMessage('teamMessage', error.message, 'error');
            }
        } catch (error) {
            this.showMessage('teamMessage', 'Error saving team member', 'error');
        }
    }

    async handlePortfolioSubmit(e) {
    e.preventDefault();
    
    console.log('📝 Starting portfolio submission...');
    
    const formData = new FormData(e.target);
    const portfolioId = document.getElementById('portfolioId').value;
    const isEdit = portfolioId && portfolioId.trim() !== '';

    // Debug: Log all form data
    console.log('Form data entries:');
    for (let [key, value] of formData.entries()) {
        console.log(`  ${key}:`, value);
    }

    // ✅ IMPORTANT: Validate required fields before submission
    const title = formData.get('title');
    const category = formData.get('category');
    const description = formData.get('description');
    const date = formData.get('date');

    if (!title || !category || !description || !date) {
        console.error('❌ Missing required fields');
        this.showMessage('portfolioMessage', 'Please fill in all required fields (Title, Category, Description, Date)', 'error');
        return;
    }

    // ✅ Validate date format
    const dateObj = new Date(date);
    if (isNaN(dateObj.getTime())) {
        console.error('❌ Invalid date:', date);
        this.showMessage('portfolioMessage', 'Please provide a valid date', 'error');
        return;
    }

    console.log('✅ Validation passed');
    console.log('Date parsed as:', dateObj.toISOString());

    try {
        // ✅ FIX: Don't include /api prefix - authenticatedFetch adds it
        const url = isEdit ? `/portfolio/${portfolioId}` : '/portfolio';
        const method = isEdit ? 'PUT' : 'POST';
        
        console.log(`📤 Sending ${method} request to:`, url);

        const response = await this.authenticatedFetch(url, {
            method,
            body: formData
        });

        console.log('📥 Response status:', response.status);

        const result = await response.json();
        console.log('📥 Response data:', result);

        if (response.ok) {
            console.log('✅ Portfolio saved successfully');
            this.showMessage(
                'portfolioMessage', 
                `Portfolio ${isEdit ? 'updated' : 'added'} successfully!`, 
                'success'
            );
            this.closeModal('portfolioModal');
            
            // Reset form
            e.target.reset();
            document.getElementById('portfolioId').value = '';
            
            // Reload data
            await this.loadPortfolio();
            await this.loadStats();
        } else {
            console.error('❌ Server returned error:', result);
            
            // Show detailed error message
            let errorMessage = result.message || 'Failed to save portfolio item';
            
            if (result.errors && Array.isArray(result.errors)) {
                errorMessage += '\n\nDetails:\n';
                result.errors.forEach(err => {
                    errorMessage += `- ${err.field}: ${err.message}\n`;
                });
            }
            
            this.showMessage('portfolioMessage', errorMessage, 'error');
        }
    } catch (error) {
        console.error('❌ Portfolio submission error:', error);
        console.error('Error details:', error.message);
        console.error('Error stack:', error.stack);
        
        this.showMessage(
            'portfolioMessage', 
            'Network error. Please check your connection and try again.', 
            'error'
        );
    }
}


    // Edit methods
    async editProperty(id) {
        try {
            const response = await this.authenticatedFetch(`/properties/${id}`);
            const property = await response.json();
            this.openModal('propertyModal', 'edit', property);
        } catch (error) {
            this.showMessage('propertiesMessage', 'Error loading property details', 'error');
        }
    }

    async editTeamMember(id) {
        try {
            const response = await this.authenticatedFetch(`/team/${id}`);
            const member = await response.json();
            this.openModal('teamModal', 'edit', member);
        } catch (error) {
            this.showMessage('teamMessage', 'Error loading team member details', 'error');
        }
    }

    async editPortfolioItem(id) {
        try {
            const response = await this.authenticatedFetch(`/portfolio/${id}`);
            const item = await response.json();
            this.openModal('portfolioModal', 'edit', item);
        } catch (error) {
            this.showMessage('portfolioMessage', 'Error loading portfolio item details', 'error');
        }
    }

    // Delete methods
    async deleteProperty(id) {
        if (!confirm('Are you sure you want to delete this property?')) return;

        try {
            const response = await this.authenticatedFetch(`/properties/${id}`, { method: 'DELETE' });
            if (response.ok) {
                this.showMessage('propertiesMessage', 'Property deleted successfully!', 'success');
                this.loadProperties();
                this.loadStats();
            } else {
                this.showMessage('propertiesMessage', 'Error deleting property', 'error');
            }
        } catch (error) {
            this.showMessage('propertiesMessage', 'Error deleting property', 'error');
        }
    }

    async deleteTeamMember(id) {
        if (!confirm('Are you sure you want to delete this team member?')) return;

        try {
            const response = await this.authenticatedFetch(`/team/${id}`, { method: 'DELETE' });
            if (response.ok) {
                this.showMessage('teamMessage', 'Team member deleted successfully!', 'success');
                this.loadTeamMembers();
                this.loadStats();
            } else {
                this.showMessage('teamMessage', 'Error deleting team member', 'error');
            }
        } catch (error) {
            this.showMessage('teamMessage', 'Error deleting team member', 'error');
        }
    }

    async deletePortfolioItem(id) {
        if (!confirm('Are you sure you want to delete this portfolio item?')) return;

        try {
            const response = await this.authenticatedFetch(`/portfolio/${id}`, { method: 'DELETE' });
            if (response.ok) {
                this.showMessage('portfolioMessage', 'Portfolio item deleted successfully!', 'success');
                this.loadPortfolio();
                this.loadStats();
            } else {
                this.showMessage('portfolioMessage', 'Error deleting portfolio item', 'error');
            }
        } catch (error) {
            this.showMessage('portfolioMessage', 'Error deleting portfolio item', 'error');
        }
    }

    // Utility methods
    async authenticatedFetch(url, options = {}) {
        const token = localStorage.getItem('adminToken');
        const config = {
            ...options,
            headers: {
                ...options.headers,
                'Authorization': `Bearer ${token}`
            }
        };
        
        return fetch(`${this.apiUrl}${url}`, config);
    }

    showLoading(buttonId, show) {
        const button = document.getElementById(buttonId);
        const text = button.querySelector('#loginText');
        const spinner = button.querySelector('#loginSpinner');
        
        if (show) {
            button.disabled = true;
            text.style.display = 'none';
            spinner.style.display = 'inline-block';
        } else {
            button.disabled = false;
            text.style.display = 'inline';
            spinner.style.display = 'none';
        }
    }

    showError(elementId, message) {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.style.display = 'block';
        setTimeout(() => {
            element.style.display = 'none';
        }, 5000);
    }

    showMessage(elementId, message, type) {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.className = `message ${type} show`;
        setTimeout(() => {
            element.classList.remove('show');
        }, 5000);
    }
}

// Global functions for onclick handlers
function closeModal(modalId) {
    dashboard.closeModal(modalId);
}

// Initialize dashboard
const dashboard = new AdminDashboard();

// ==============================================
// CONFIGURATION - Works on both local and production
// ==============================================
const API_BASE_URL = `${window.location.origin}/api`;

// Return headers with auth token
function getAuthHeaders() {
    const token = localStorage.getItem("adminToken");
    return {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`
    };
}

// ==============================================
// NEWSLETTER SUBSCRIBERS
// ==============================================
async function loadNewsletterSubscribers() {
    const token = localStorage.getItem('adminToken');
    console.log('Newsletter - Token check:', token ? 'Token exists' : 'No token found');
    
    if (!token) {
        console.warn("No token available for newsletter");
        return;
    }

    try {
        const res = await fetch(`${API_BASE_URL}/newsletter`, {
            headers: { 
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        console.log('Newsletter response status:', res.status);

        if (res.status === 401 || res.status === 403) {
            console.error('Newsletter authentication failed');
            return;
        }

        if (!res.ok) {
            throw new Error(`HTTP ${res.status}`);
        }

        const data = await res.json();
       
        const tbody = document.getElementById('newsletterTableBody');
        tbody.innerHTML = '';

        if (!data.success || !data.subscribers || data.subscribers.length === 0) {
            tbody.innerHTML = `<tr><td colspan="3" style="text-align:center;">No subscribers found</td></tr>`;
            return;
        }

        data.subscribers.forEach(sub => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${sub.email}</td>
                <td>${new Date(sub.subscribedAt).toLocaleString()}</td>
                <td>${sub.status || 'active'}</td>
            `;
            tbody.appendChild(tr);
        });
        
        console.log('Newsletter loaded successfully:', data.subscribers.length, 'subscribers');
    } catch (err) {
        console.error("Failed to load newsletter subscribers", err);
        const tbody = document.getElementById('newsletterTableBody');
        tbody.innerHTML = `<tr><td colspan="3" style="text-align:center;color:#e53e3e;">Error loading subscribers</td></tr>`;
    }
}

// ==============================================
// DASHBOARD OVERVIEW
// ==============================================
async function loadDashboardOverview() {
    try {
        const token = localStorage.getItem("adminToken");
        if (!token) {
            console.warn("No token available for dashboard overview");
            return;
        }

        const response = await fetch(`${API_BASE_URL}/analytics/overview`, {
            headers: { 
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
            }
        });

        if (response.status === 401 || response.status === 403) {
            console.error("Authentication failed, clearing token");
            localStorage.removeItem('adminToken');
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('dashboardPage').style.display = 'none';
            return;
        }

        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();

        // Safely access nested properties
        if (data && data.totals) {
            document.getElementById("totalVisits").textContent = data.totals.visits || 0;
            document.getElementById("confirmedVisits").textContent = data.totals.confirmedVisits || 0;
            document.getElementById("pendingVisits").textContent = data.totals.pendingVisits || 0;
        } else {
            console.warn("Dashboard overview data structure unexpected:", data);
            document.getElementById("totalVisits").textContent = 0;
            document.getElementById("confirmedVisits").textContent = 0;
            document.getElementById("pendingVisits").textContent = 0;
        }
    } catch (error) {
        console.error("Error loading dashboard overview:", error);
        // Set default values on error
        document.getElementById("totalVisits").textContent = 0;
        document.getElementById("confirmedVisits").textContent = 0;
        document.getElementById("pendingVisits").textContent = 0;
    }
}

// ==============================================
// PROPERTY IMAGE PREVIEW
// ==============================================
document.getElementById("propertyImage").addEventListener("change", function() {
    const preview = document.getElementById("preview");
    preview.innerHTML = "";
    Array.from(this.files).forEach(file => {
        let p = document.createElement("p");
        p.textContent = file.name;
        preview.appendChild(p);
    });
    let count = document.createElement("p");
    count.textContent = `Total files: ${this.files.length}`;
    preview.appendChild(count);
});

// ==============================================
// NAVIGATION FUNCTIONALITY
// ==============================================
document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', function() {
        document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
        this.classList.add('active');
        
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
        });
        
        const targetSection = this.getAttribute('data-section');
        document.getElementById(targetSection).classList.add('active');
    });
});

// ==============================================
// LOGOUT FUNCTIONALITY
// ==============================================
document.getElementById('logoutBtn').addEventListener('click', function() {
    if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('adminToken');
        localStorage.removeItem('adminInfo');
        document.getElementById('dashboardPage').style.display = 'none';
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('loginForm').reset();
    }
});

// ==============================================
// MODAL FUNCTIONALITY
// ==============================================
function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

document.getElementById('addPropertyBtn').addEventListener('click', function() {
    document.getElementById('propertyModalTitle').textContent = 'Add Property';
    document.getElementById('propertyForm').reset();
    document.getElementById('propertyModal').style.display = 'block';
});

document.getElementById('addTeamBtn').addEventListener('click', function() {
    document.getElementById('teamModalTitle').textContent = 'Add Team Member';
    document.getElementById('teamForm').reset();
    document.getElementById('teamModal').style.display = 'block';
});

document.getElementById('addPortfolioBtn').addEventListener('click', function() {
    document.getElementById('portfolioModalTitle').textContent = 'Add Portfolio Item';
    document.getElementById('portfolioForm').reset();
    document.getElementById('portfolioModal').style.display = 'block';
});

// ==============================================
// FORM SUBMISSIONS
// ==============================================
document.getElementById('propertyForm').addEventListener('submit', function(e) {
    e.preventDefault();
    showMessage('propertiesMessage', 'Property saved successfully!', 'success');
    closeModal('propertyModal');
});

document.getElementById('teamForm').addEventListener('submit', function(e) {
    e.preventDefault();
    showMessage('teamMessage', 'Team member saved successfully!', 'success');
    closeModal('teamModal');
});

document.getElementById('portfolioForm').addEventListener('submit', function(e) {
    e.preventDefault();
    showMessage('portfolioMessage', 'Portfolio item saved successfully!', 'success');
    closeModal('portfolioModal');
});

// Show message function
function showMessage(elementId, message, type) {
    const messageEl = document.getElementById(elementId);
    messageEl.textContent = message;
    messageEl.className = `message ${type} show`;
    setTimeout(() => {
        messageEl.classList.remove('show');
    }, 3000);
}

// Close modal when clicking outside
window.addEventListener('click', function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
    }
});

// Counter animation
function animateCounter(elementId, targetValue) {
    const element = document.getElementById(elementId);
    let currentValue = 0;
    const increment = targetValue / 30;
    const timer = setInterval(() => {
        currentValue += increment;
        if (currentValue >= targetValue) {
            element.textContent = targetValue;
            clearInterval(timer);
        } else {
            element.textContent = Math.floor(currentValue);
        }
    }, 50);
}

// ==============================================
// SCHEDULED VISITS MANAGEMENT
// ==============================================
let scheduledVisitsData = [];
let propertiesData = {};

function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
    });
}

function formatTime(timeString) {
    const [hours, minutes] = timeString.split(':');
    const hour24 = parseInt(hours);
    const hour12 = hour24 === 0 ? 12 : hour24 > 12 ? hour24 - 12 : hour24;
    const ampm = hour24 >= 12 ? 'PM' : 'AM';
    return `${hour12}:${minutes} ${ampm}`;
}

function getStatusBadge(status) {
    const statusMap = {
        'pending': 'pending',
        'confirmed': 'confirmed',
        'completed': 'completed',
        'cancelled': 'cancelled'
    };
    
    const badgeClass = statusMap[status] || 'pending';
    const displayStatus = status.charAt(0).toUpperCase() + status.slice(1);
    
    return `<span class="status-badge ${badgeClass}">${displayStatus}</span>`;
}

async function loadProperties() {
    try {
        const token = localStorage.getItem('adminToken');
        if (!token) return;

        const response = await fetch(`${API_BASE_URL}/public/properties`, {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        if (!response.ok) {
            console.warn('Failed to load properties for scheduled visits');
            return;
        }
        
        const properties = await response.json();
        propertiesData = {};
        
        properties.forEach(property => {
            propertiesData[property.id] = property;
        });
    } catch (error) {
        console.error('Error loading properties:', error);
    }
}

async function loadScheduledVisits() {
    const tableBody = document.getElementById('scheduledVisitsTableBody');
    
    try {
        const token = localStorage.getItem('adminToken');
        if (!token) {
            console.warn("No token for scheduled visits");
            tableBody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Please log in to view scheduled visits</td></tr>';
            return;
        }

        await loadProperties();
        
        const response = await fetch(`${API_BASE_URL}/schedule-visits`, {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        if (response.status === 401 || response.status === 403) {
            console.error('Authentication failed for scheduled visits');
            tableBody.innerHTML = '<tr><td colspan="8" style="text-align:center;color:#e53e3e;">Authentication failed. Please log in again.</td></tr>';
            return;
        }

        if (!response.ok) {
            throw new Error(`Failed to load scheduled visits: HTTP ${response.status}`);
        }
        
        scheduledVisitsData = await response.json();
        
        if (!scheduledVisitsData || scheduledVisitsData.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="8">
                        <div class="empty-state">
                            <i class="fas fa-calendar-times"></i>
                            <h3>No Scheduled Visits</h3>
                            <p>No property visits have been scheduled yet.</p>
                        </div>
                    </td>
                </tr>
            `;
            return;
        }
        
        renderScheduledVisits();
        
    } catch (error) {
        console.error('Error loading scheduled visits:', error);
        tableBody.innerHTML = `
            <tr>
                <td colspan="8" style="text-align: center; padding: 2rem; color: #e53e3e;">
                    <i class="fas fa-exclamation-triangle"></i> 
                    Error loading scheduled visits: ${error.message}
                </td>
            </tr>
        `;
    }
}

function renderScheduledVisits() {
    const tableBody = document.getElementById('scheduledVisitsTableBody');
    
    const rows = scheduledVisitsData.map(visit => {
        const property = visit.propertyId;
        const propertyTitle = property ? property.title : `Property #${property?._id || ''}`;
        const propertyLocation = property ? property.location : 'Unknown location';

        return `
            <tr>
                <td>
                    <div class="client-info">
                        <div class="client-name">${visit.firstName} ${visit.lastName}</div>
                        ${visit.message ? `<div class="client-message" title="${visit.message}">${visit.message}</div>` : ''}
                    </div>
                </td>
                <td><a href="mailto:${visit.email}" style="color: #3182ce;">${visit.email}</a></td>
                <td><a href="tel:${visit.phone}" style="color: #3182ce;">${visit.phone}</a></td>
                <td>
                    <div style="display: flex; flex-direction: column; gap: 2px;">
                        <a href="propertyDetails.html?id=${property ? property._id : ''}" class="property-link" target="_blank">
                            ${propertyTitle}
                        </a>
                        <small style="color: #718096;">${propertyLocation}</small>
                    </div>
                </td>
                <td>${formatDate(visit.preferredDate)}</td>
                <td>${formatTime(visit.preferredTime)}</td>
                <td>${getStatusBadge(visit.status || 'pending')}</td>
                <td>
                    <button class="action-btn edit-btn" onclick="viewVisitDetails('${visit._id}')">
                        <i class="fas fa-eye"></i> View
                    </button>
                    ${visit.status === 'pending' ? `
                        <button class="action-btn confirm-btn" onclick="confirmVisit('${visit._id}')">
                            <i class="fas fa-check"></i> Confirm
                        </button>
                    ` : ''}
                    <button class="action-btn delete-btn" onclick="deleteVisit('${visit._id}')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </td>
            </tr>
        `;
    }).join('');

    tableBody.innerHTML = rows;
}

function viewVisitDetails(visitId) {
    const visit = scheduledVisitsData.find(v => v._id === visitId);
    if (!visit) return;
    
    const property = propertiesData[visit.propertyId];
    const propertyInfo = property ? 
        `${property.title} - ${property.location}` : 
        `Property #${visit.propertyId}`;
    
    const details = `
        Client: ${visit.firstName} ${visit.lastName}
        Email: ${visit.email}
        Phone: ${visit.phone}
        Property: ${propertyInfo}
        Date: ${formatDate(visit.preferredDate)}
        Time: ${formatTime(visit.preferredTime)}
        Status: ${(visit.status || 'pending').charAt(0).toUpperCase() + (visit.status || 'pending').slice(1)}
        ${visit.message ? `\nMessage: ${visit.message}` : ''}
        Created: ${new Date(visit.createdAt).toLocaleString()}
    `;
    
    alert(details);
}

async function confirmVisit(visitId) {
    if (!confirm('Confirm this visit appointment?')) return;
    
    try {
        const response = await fetch(`${API_BASE_URL}/schedule-visits/${visitId}`, {
            method: 'PATCH',
            headers: getAuthHeaders(),
            body: JSON.stringify({ status: 'confirmed' })
        });
        
        if (response.status === 401) {
            alert('Authentication required. Please log in again.');
            return;
        }
        
        if (!response.ok) throw new Error('Failed to confirm visit');
        
        const visitIndex = scheduledVisitsData.findIndex(v => v._id === visitId);
        if (visitIndex !== -1) {
            scheduledVisitsData[visitIndex].status = 'confirmed';
            renderScheduledVisits();
        }
        
        alert('Visit confirmed successfully!');
        
    } catch (error) {
        console.error('Error confirming visit:', error);
        alert('Error confirming visit: ' + error.message);
    }
}

async function deleteVisit(visitId) {
    if (!confirm('Are you sure you want to delete this scheduled visit?')) return;
    
    try {
        const response = await fetch(`${API_BASE_URL}/schedule-visits/${visitId}`, {
            method: 'DELETE',
            headers: getAuthHeaders()
        });
        
        if (response.status === 401) {
            alert('Authentication required. Please log in again.');
            return;
        }
        
        if (!response.ok) throw new Error('Failed to delete visit');
        
        scheduledVisitsData = scheduledVisitsData.filter(v => v._id !== visitId);
        renderScheduledVisits();
        
        alert('Visit deleted successfully!');
        
    } catch (error) {
        console.error('Error deleting visit:', error);
        alert('Error deleting visit: ' + error.message);
    }
}

// ==============================================
// ACHIEVEMENTS MANAGEMENT
// ==============================================
function showAlert(message, type = 'success') {
    const alertEl = document.getElementById('alert');
    alertEl.textContent = message;
    alertEl.className = `alert alert-${type}`;
    alertEl.style.display = 'block';
    setTimeout(() => alertEl.style.display = 'none', 5000);
}

async function loadCurrentValues() {
    try {
        const token = localStorage.getItem('adminToken');
        if (!token) {
            console.warn("No token for achievements");
            return;
        }

        const response = await fetch(`${API_BASE_URL}/achievements`, {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        if (response.status === 401 || response.status === 403) {
            console.error('Authentication failed for achievements');
            return;
        }

        if (!response.ok) throw new Error(`HTTP ${response.status}`);

        const data = await response.json();
        if (data.success) {
            const a = data.data || {};
            document.getElementById('currentListings').textContent = a.listings || 0;
            document.getElementById('currentProperties').textContent = a.propertiesManaged || 0;
            document.getElementById('currentTransactions').textContent = a.transactions || 0;
            document.getElementById('currentProjects').textContent = a.projects || 0;

            document.getElementById('listings').value = a.listings || 0;
            document.getElementById('propertiesManaged').value = a.propertiesManaged || 0;
            document.getElementById('transactions').value = a.transactions || 0;
            document.getElementById('projects').value = a.projects || 0;

            showAlert('Current values loaded!', 'success');
        } else {
            throw new Error(data.message || 'Failed to load achievements');
        }
    } catch (err) {
        console.error(err);
        showAlert('Error loading current values: ' + err.message, 'error');
    }
}

document.getElementById('achievementForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<span class="loading"></span> Updating...';
    submitBtn.disabled = true;

    try {
        const token = localStorage.getItem('adminToken');
        if (!token) {
            throw new Error('No authentication token found');
        }

        const formData = new FormData(this);
        const payload = {
            listings: parseInt(formData.get('listings')),
            propertiesManaged: parseInt(formData.get('propertiesManaged')),
            transactions: parseInt(formData.get('transactions')),
            projects: parseInt(formData.get('projects'))
        };

        const response = await fetch(`${API_BASE_URL}/achievements`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        });

        if (response.status === 401 || response.status === 403) {
            throw new Error('Authentication failed. Please log in again.');
        }

        const result = await response.json();
        if (response.ok && result.success) {
            showAlert('Achievements updated!', 'success');
            loadCurrentValues();
        } else {
            throw new Error(result.message || 'Failed to update achievements');
        }
    } catch (err) {
        console.error(err);
        showAlert('Error updating achievements: ' + err.message, 'error');
    } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
});

// ==============================================
// INITIALIZATION
// ==============================================
document.addEventListener('DOMContentLoaded', function() {
    // Check if user is already logged in
    const token = localStorage.getItem('adminToken');
    
    if (token) {
        console.log('Found existing token, loading dashboard data...');
        // Small delay to ensure DOM is ready
        setTimeout(() => {
            loadNewsletterSubscribers();
            loadDashboardOverview();
            loadScheduledVisits();
            loadCurrentValues();
        }, 500);
    }
    
    // Refresh data every 30 seconds if logged in
    setInterval(() => {
        const currentToken = localStorage.getItem('adminToken');
        if (currentToken) {
            loadScheduledVisits();
            loadDashboardOverview();
        }
    }, 30000);
});
</script>


<script>
    // Fetch and update visitor statistics
    async function updateVisitorStats() {
        try {
            const response = await fetch('/api/visitor-stats');
            const data = await response.json();
            
            // Update the visitor count
            document.getElementById('websiteVisitors').textContent = data.totalVisitors;
            document.getElementById('todayVisitors').textContent = `Today: ${data.todayVisitors}`;
        } catch (error) {
            console.error('Error fetching visitor stats:', error);
        }
    }

    // Track visitor on page load (optional - middleware already tracks)
    async function trackVisit() {
        try {
            await fetch('/api/track-visit', {
                method: 'POST',
                credentials: 'include' // Important for cookies
            });
        } catch (error) {
            console.error('Error tracking visit:', error);
        }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
        updateVisitorStats();
        // Refresh stats every 30 seconds
        setInterval(updateVisitorStats, 30000);
    });
</script>

</body>
</html>